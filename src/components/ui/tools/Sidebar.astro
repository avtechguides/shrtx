---
import ToolSearch from '@components/ui/tools/ToolSearch.astro';
import CategoryGallery from '@components/sections/CategoryGallery.astro';

interface Props {
  tools: any[];
  class?: string;
}
const { tools, class: className = "" } = Astro.props as Props;

const slugify = (s: string) => s.toLowerCase().replace(/\s+/g, '-');
const formatCat = (s: string) => s.replace(/-/g, ' ').replace(/\b\w/g, (c: string) => c.toUpperCase());

const counts = (tools || []).reduce<Record<string, number>>((acc, t) => {
  const key = (t.category || 'uncategorized').toLowerCase();
  acc[key] = (acc[key] || 0) + 1;
  return acc;
}, {});
const categories = Object.keys(counts)
  .sort((a, b) => a.localeCompare(b))
  .map((c) => ({ name: formatCat(c), slug: slugify(c), count: counts[c], href: `/tools/categories/${slugify(c)}` }));
---

<aside class={`sticky top-20 space-y-6 p-4 rounded-xl min-w-[220px]
  bg-[var(--color-bg-secondary)]
  border border-[var(--color-border)]
  shadow-sm ${className}`}>
  <ToolSearch tools={tools} />

  <div>
    <h2 class="font-semibold text-base mb-3 text-[var(--color-text-primary)]">Categories</h2>

    <CategoryGallery
      tools={tools}
      title="Browse categories"
      subtitle="Jump into a group of tools."
      variant="sidebar"
      maxItems={20}
    />
  </div>
</aside>
