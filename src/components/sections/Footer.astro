---
import Button from "../ui/button/Button.astro";
import contactIconRaw from "../../assets/icons/contact-icon.svg?raw";
import CookieToast from "../ui/CookieToast.astro";
import CookiePreferencesModal from "../ui/CookiePreferencesModal.astro";

function sanitizeToWhite(svg: string, size = 18) {
  let s = svg
    .replace(/<\?xml[\s\S]*?\?>/g, "")
    .replace(/<!--([\s\S]*?)-->/g, "")
    .replace(/width=\"[^\"]*\"/g, "")
    .replace(/height=\"[^\"]*\"/g, "")
    .replace(/fill=\"[^\"]*\"/gi, 'fill="currentColor"')
    .replace(/stroke=\"[^\"]*\"/gi, 'stroke="none"');
  s = s.replace(/<svg([^>]*)>/, (m, attrs) => `<svg${attrs} width="${size}" height="${size}">`);
  return s;
}

const contactIcon = sanitizeToWhite(contactIconRaw);
const currentYear = new Date().getFullYear();

const footerMenu = [
  { text: "About", href: "/about/" },
  { text: "Contact", href: "/contact/" },
  { text: "Blog", href: "/blog/" },
  { text: "Privacy Policy", href: "/privacy/" },
  { text: "Terms of Service", href: "/terms/" },
  { text: "Disclaimer", href: "/disclaimer/" },
  { text: "Cookie Policy", href: "/cookie/" }
];

const socialLinks = [
  { href: "https://x.com/shrtx", label: "X", icon: `<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M23 3a10.9 10.9 0 01-3.14 0.86A4.48 4.48 0 0022.4 1a9.1 9.1 0 01-2.88 1.1 4.52 4.52 0 00-7.69 4.13 12.86 12.86 0 01-9.33-4.74 4.52 4.52 0 001.4 6.04 4.49 4.49 0 01-2.05-.57v0.06a4.52 4.52 0 003.63 4.43 4.51 4.51 0 01-2.04.08 4.52 4.52 0 004.22 3.14A9.06 9.06 0 012 19.54 12.8 12.8 0 008.29 21c7.55 0 11.68-6.26 11.68-11.68 0-0.18 0-0.36-0.01-0.54A8.36 8.36 0 0023 3z"/></svg>` },
  { href: "https://github.com/avtechguides", label: "GitHub", icon: `<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 .5C5.37.5 0 5.87 0 12.5c0 5.29 3.44 9.77 8.21 11.36.6.11.82-.26.82-.58v-2.03c-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.09-.75.08-.73.08-.73 1.2.09 1.83 1.23 1.83 1.23 1.07 1.84 2.8 1.31 3.48 1 .11-.77.42-1.31.76-1.61-2.67-.3-5.47-1.34-5.47-5.96 0-1.32.47-2.39 1.23-3.23-.12-.3-.54-1.51.12-3.15 0 0 1.01-.32 3.3 1.23a11.42 11.42 0 016 0c2.28-1.55 3.29-1.23 3.29-1.23.66 1.64.24 2.85.12 3.15.76.84 1.23 1.91 1.23 3.23 0 4.63-2.8 5.66-5.48 5.96.43.37.82 1.1.82 2.22v3.29c0 .32.22.69.83.58A12.01 12.01 0 0024 12.5C24 5.87 18.63.5 12 .5z"/></svg>` },
  { href: "#", label: "Telegram", icon: `<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9.99 13.72l-.38 5.4c.55 0 .79-.24 1.1-.53l2.64-2.43 5.48 4.01c1.01.56 1.72.27 1.97-.93l3.58-16.94c.35-1.53-.57-2.12-1.54-1.76L1.57 10.8c-1.42.57-1.39 1.36-.25 1.72l5.79 1.8 13.44-8.45c.63-.39 1.21-.18.74.25l-10.11 9.15z"/></svg>` },
  { href: "#", label: "LinkedIn", icon: `<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4.98 3.5C3.34 3.5 2 4.84 2 6.5s1.34 3 2.98 3c1.65 0 2.99-1.34 2.99-3S6.63 3.5 4.98 3.5zM2 9h5.97v12H2V9zm7.5 0h5.72v1.63h.08c.8-1.51 2.75-3.11 5.67-3.11 6.07 0 7.19 3.99 7.19 9.18V21h-5.97v-7.77c0-1.85-.03-4.22-2.57-4.22-2.57 0-2.97 2.01-2.97 4.09V21h-5.97V9z"/></svg>` }
];
---

<footer class="py-8 px-4 sm:px-6 bg-[var(--card)] text-[var(--card-foreground)] border-t border-[var(--border)]">
  <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-start md:items-center justify-between gap-6 md:gap-8">

    <!-- Branding -->
    <div class="flex flex-col items-center md:items-start text-center md:text-left w-full md:w-auto">
      <img src="/LOGO-SHRTX-TP-whitebg.svg" alt="SHRTX Logo" class="h-10 max-w-full w-auto mb-2" loading="lazy" decoding="async" />
      <p class="mt-2 text-sm sm:text-xs text-[var(--muted-foreground,#6b7280)]">
        Shorten, share, and track URLs securely.
      </p>
      <p class="mt-1 text-xs sm:text-[10px] text-[var(--muted-foreground,#6b7280)]">
        Powered by <a href="https://avtechguides.com" class="hover:text-[var(--accent)] transition-colors inline-flex items-center">AV TechGuides</a>
      </p>
    </div>

    <!-- Footer Menu -->
    <nav aria-label="Footer" class="w-full md:w-auto">
      <ul class="flex flex-col sm:flex-row flex-wrap justify-center md:justify-start items-center gap-3 text-sm sm:text-xs text-[var(--muted-foreground,#6b7280)]">
        {footerMenu.map((item) => (
          <li>
            <a href={item.href} class="hover:text-[var(--accent)] transition-colors">{item.text}</a>
          </li>
        ))}
        <li>
          <button type="button" data-open-cookie-modal class="underline underline-offset-2 hover:text-[var(--accent)] text-sm sm:text-xs">
            Manage Cookies
          </button>
        </li>
      </ul>
    </nav>

    <!-- Social & Contact -->
    <div class="flex flex-col items-center md:items-end gap-3 w-full md:w-auto">
      <div class="flex gap-3 flex-wrap justify-center md:justify-end text-[var(--foreground)]">
        {socialLinks.map((social) => (
          <a
            href={social.href}
            target="_blank"
            rel="noopener noreferrer"
            aria-label={social.label}
            class="hover:text-[var(--accent)] transition-colors"
            set:html={social.icon}
          ></a>
        ))}
      </div>

      <Button href="mailto:contact@shrtx.com" variant="primary" size="md" class="w-full max-w-xs">
        <span class="inline-flex mr-2" aria-hidden="true" set:html={contactIcon}></span>
        Contact Us
      </Button>

      <p class="mt-2 text-sm sm:text-xs text-[var(--muted-foreground,#6b7280)]">&copy; {currentYear} SHRTX</p>
    </div>

  </div>

  <CookieToast />
  <CookiePreferencesModal />
</footer>

<style>
  [set\\:html] svg {
    width: 1em;
    height: 1em;
    display: block;
  }
  [set\\:html] svg [fill]:not([fill="none"]) {
    fill: currentColor;
  }
  [set\\:html] svg [stroke]:not([stroke="none"]) {
    stroke: currentColor;
  }
</style>
