---
import ToolsLayout from '@layouts/ToolsLayout.astro';
import ToolCard from '@components/ui/tools/ToolCard.astro';
import ToolsPagination from '@components/ui/nav/ToolsPagination.astro';
import CategoryGallery from '@components/sections/CategoryGallery.astro';
import ToolSearch from '@components/ui/tools/ToolSearch.astro';
import { tools } from '@data/tools/tools';
import { slugifyTag } from '@lib/slug';

export const prerender = true;

const PAGE_SIZE = 12;

// Sort tools by popularity then title
const sortedTools = [...tools].sort(
  (a, b) => (b.popularity ?? 0) - (a.popularity ?? 0) || a.title.localeCompare(b.title)
);

const pageTitle = 'SHRTX Utility Tools';
const pageDescription =
  'All the web tools you need for your daily hustle â€” speedy, dependable, and designed with you in mind.';

// Pagination
const currentPage = Number(Astro.params.page ?? 1);
const totalPages = Math.ceil(sortedTools.length / PAGE_SIZE);
const paginatedTools = sortedTools.slice(
  (currentPage - 1) * PAGE_SIZE,
  currentPage * PAGE_SIZE
);
---

<ToolsLayout title={pageTitle} description={pageDescription} showHeader={true}>

  <!-- Search panel -->
  <ToolSearch tools={tools} />

  <!-- Categories Section -->
  <section class="space-y-6">
    <div>
      <h2 class="text-2xl font-bold mb-2">
        <span class="bg-gradient-to-r from-[var(--accent)] to-[var(--accent-dark)] bg-clip-text text-transparent">
          Explore by Category
        </span>
      </h2>
      <p class="text-[var(--color-text-muted)]">Jump into a group of tools tailored to specific tasks.</p>
    </div>

    <CategoryGallery
      tools={tools}
      title=""
      subtitle=""
    />
  </section>

  <!-- Latest Tools Section -->
  <section class="mt-10 space-y-6">
    <h2 class="text-2xl font-bold mb-2">
      <span class="bg-gradient-to-r from-[var(--accent)] to-[var(--accent-dark)] bg-clip-text text-transparent">
        Latest Tools
      </span>
    </h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {paginatedTools.map((tool) => (
        <ToolCard {...tool} />
      ))}
    </div>

    {totalPages > 1 && (
      <ToolsPagination currentPage={currentPage} totalPages={totalPages} />
    )}
  </section>
</ToolsLayout>
