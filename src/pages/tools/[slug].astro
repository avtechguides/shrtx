---
import ToolsLayout from '@layouts/ToolsLayout.astro';
import ToolNav from '@components/ui/nav/ToolNav.astro';
import { tools } from '@data/tools/tools';
import { slugifyTag } from '@lib/slug';

export const prerender = true;

export function getStaticPaths() {
  return tools
    .filter((t) => !!t.slug)
    .map((t) => ({
      params: { slug: t.slug as string },
      props: { tool: t },
    }));
}

type Tool = typeof tools[number];
type Props = { tool?: Tool };

const { slug } = Astro.params;
const { tool: toolFromProps } = (Astro.props as Props) ?? {};
const tool = toolFromProps ?? tools.find((t) => t.slug === slug);
if (!tool) return Astro.redirect('/404');

// Page meta
const pageTitle = `${tool.title} - SHRTX Tools`;
const pageDescription = tool.description ?? '';
const path = `/tools/${tool.slug}`;

// Neighbor navigation (sorted by title; switch to popularity if preferred)
const sorted = [...tools]
  .filter(t => !!t.slug)
  .sort((a, b) => a.title.localeCompare(b.title));
const idx = sorted.findIndex(t => t.slug === tool.slug);
const prevTool = idx > 0 ? sorted[idx - 1] : null;
const nextTool = idx >= 0 && idx < sorted.length - 1 ? sorted[idx + 1] : null;

// Category breadcrumb
const categoryName = tool.category ?? '';
const categorySlug = categoryName ? slugifyTag(categoryName) : '';
const categoryHref = categorySlug ? `/tools/categories/${categorySlug}` : '';
---

<ToolsLayout
  title={pageTitle}
  description={pageDescription}
  path={path}
  category={categoryName}
  popularity={tool.popularity}
  isPremium={tool.isPremium}
>
  {categoryHref && (
    <p class="text-sm text-[var(--color-text-muted)]">
      <a href="/tools" class="hover:underline">Tools</a>
      {categoryName && (
        <>
          {' '}â€¢{' '}
          <a href={categoryHref} class="hover:underline">
            {categoryName.replace(/-/g, ' ')}
          </a>
        </>
      )}
    </p>
  )}

  <section class="space-y-6 mt-4">
    <h2 class="text-2xl font-semibold">About this tool</h2>
    <p>{tool.description ?? 'Tool description coming soon.'}</p>

    <!-- Add tool-specific UI here -->
  </section>

  <ToolNav
    prev={prevTool ? { id: prevTool.slug!, title: prevTool.title } : null}
    next={nextTool ? { id: nextTool.slug!, title: nextTool.title } : null}
  />
</ToolsLayout>
