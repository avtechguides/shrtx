---
import ToolsLayout from '@layouts/ToolsLayout.astro';
import ToolCard from '@components/ui/tools/ToolCard.astro';
import ToolsPagination from '@components/ui/nav/ToolsPagination.astro';
import { tools } from '@data/tools/tools';
import { slugifyTag } from '@lib/slug';

export const prerender = true;

// Generate static paths for all categories
export function getStaticPaths() {
  const categories = Array.from(
    new Set(tools.filter(t => t.category).map(t => t.category))
  );
  return categories.map((category) => ({
    params: { category: category ? slugifyTag(category) : '' },
  }));
}

// Get current category slug from URL
const { category: catSlug } = Astro.params;

// Filter tools by category
const categoryTools = tools.filter(
  (t) => t.category && slugifyTag(t.category) === catSlug
);

if (!categoryTools.length) return Astro.redirect('/404');

// Get category name from first tool
const categoryName = categoryTools[0].category ?? '';
const cleanCategory = categoryName.trim();

// Avoid duplicate "Tools" in title
const pageTitle = cleanCategory.endsWith('Tools')
  ? `${cleanCategory} - SHRTX`
  : `${cleanCategory} Tools - SHRTX`;

const pageDescription = `Explore all tools under the ${cleanCategory} category.`;

// Pagination (optional)
const currentPage = 1;
const perPage = 12;
const totalPages = Math.ceil(categoryTools.length / perPage);
const paginatedTools = categoryTools.slice(
  (currentPage - 1) * perPage,
  currentPage * perPage
);
---

<ToolsLayout
  title={pageTitle}
  description={pageDescription}
  category={cleanCategory}
  showHeader={true}
>

  <!-- Tools grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {paginatedTools.map((tool) => (
      <ToolCard {...tool} />
    ))}
  </div>

  <!-- Pagination -->
  {totalPages > 1 && (
    <ToolsPagination
      currentPage={currentPage}
      totalPages={totalPages}
      basePath={`/tools/categories/${catSlug}`}
    />
  )}
</ToolsLayout>
